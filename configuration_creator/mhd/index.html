<!DOCTYPE html>
<html><head><meta charset="utf-8"></meta></head></html>
<!--
Interactive interface for creating configuration files for MHD test of PAMHD.

Copyright 2015, 2016 Ilja Honkonen
All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice, this
  list of conditions and the following disclaimer in the documentation and/or
  other materials provided with the distribution.

* Neither the names of the copyright holders nor the names of their contributors
  may be used to endorse or promote products derived from this software
  without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html>
<head>
<title>Interactive configuration file creator for MHD test program of PAMHD</title>

<style type="text/css">
div[id ^= "bdy_input"] {display: inline-block;}
</style>

<!-- javascript block start -->

<noscript>
	<p><h1>WARNING: This page does not work without javascript</h1></p>
</noscript>
<script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/2.4.1/math.min.js" type="text/javascript"></script>
<script>window.math || document.write('<script src="math.min.js">\x3C/script>')</script>
<!-- javascript functions start -->
<script name="script" type="text/javascript">

// variable sets available in math expressions
var
	empty_context = {},
	time_place_context = {
		t: 0,
		x: 0, y: 0, z: 0,
		radius: 0, lat: 0, lon: 0
	},
	time_place_current_context = {
		t: 0,
		x: 0, y: 0, z: 0,
		radius: 0, lat: 0, lon: 0,
		J: 0
	};


function validate_expression(element_id, validator, context)
{
	expression = document.getElementById(element_id);
	result = document.getElementById(element_id + "_test");

	// mathjs starts indices from 1
	adjusted_expression = expression.value
		.split("[3]").join("[4]")
		.split("[2]").join("[3]")
		.split("[1]").join("[2]")
		.split("[0]").join("[1]");

	try {
		var evaluated = math.eval(adjusted_expression, context);
		if (validator(evaluated)) {
			result.innerHTML = "";
			result.style.color = "initial";
			return;
		} else {
			result.innerHTML = "Invalid value in expression";
			result.style.color = "red";
			return;
		}
	} catch(error) {
		result.innerHTML = "Error in expression";
		result.style.color = "red";
		return;
	}
}

//! returns true for number > 0, false otherwise
function gt_zero(number)
{
	if (isFinite(number)) {
		if (number > 0) {
			return true;
		}
	}
	return false;
}


// converts parentheses in submitted form to brackets
function convert_parentheses() {
	form = document.getElementById("form");
	for (i in form.elements) {
		element = form.elements[i];
		if (typeof element.value == "string") {
			element.value = element.value.split("(").join("[").split(")").join("]");
		}
	}
	return true;
}


window.onload = function() {

if (typeof math == "undefined") {
	document.body.innerHTML = "ERROR: Could not load math.js library!";
	return;
}


//! Returns a text input element with given id and identical name.
function make_input_element(id_string)
{
	var input = document.createElement("input");
	input.setAttribute("type", "text");
	input.setAttribute("id", id_string);
	input.setAttribute("name", id_string);
	return input;
}

// As make_input_element but also uses validator with given
// context/scope to validate expression typed into returned text element.
function make_input_element_for_expression(id_string, validator_str, context_str)
{
	var input = document.createElement("input");
	input.setAttribute("type", "text");
	input.setAttribute("id", id_string);
	input.setAttribute("name", id_string);
	if (
		typeof validator_str == "string"
		&& validator_str != ""
		&& typeof context_str == "string"
		&& context_str != ""
	) {
		input.setAttribute("onblur", "validate_expression(this.id," + validator_str + ", " + context_str + ")");
	}
	return input;
}


function make_span(id_string)
{
	var span = document.createElement("span");
	span.setAttribute("id", id_string);
	return span;
}


// geometry related stuff
var nr_geometries = 0;

// removes last exiting geometry
function remove_geometry()
{
	if (nr_geometries <= 0) {
		return;
	}

	geometry_id = (nr_geometries - 1).toString();
	nr_geometries = nr_geometries - 1;

	box = document.getElementById("box" + geometry_id);
	if (box != null) {
		box.parentNode.removeChild(box);
		return;
	}

	sphere = document.getElementById("sphere" + geometry_id);
	if (sphere != null) {
		sphere.parentNode.removeChild(sphere);
		return;
	}

	alert("Unexpected shape in geometry id " + geometry_id);
}

geometry_remover = document.getElementById("remove_geometry_btn");
geometry_remover.addEventListener("click", remove_geometry);

// adds geometry of given shape after last existing geometry
function make_geometry(shape)
{

	if (shape != "box" && shape != "sphere") {
		alert("Unsupported geometry given to make_geometry");
	}

	geometry_id = nr_geometries.toString();
	nr_geometries = nr_geometries + 1;

	id_string = shape + geometry_id;

	var fieldset = document.createElement("fieldset");
	fieldset.setAttribute("id", id_string);

	var legend = document.createElement("legend");
	if (shape == "box") {
		legend.innerHTML = "Box";
	} else if (shape == "sphere") {
		legend.innerHTML = "Sphere";
	}
	legend.innerHTML = legend.innerHTML + ", geometry id: " + geometry_id;
	fieldset.appendChild(legend);

	if (shape == "box") {

		fieldset.appendChild(document.createTextNode("Start coordinate (x, y, z) "));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_startx", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_starty", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_startz", "isFinite", "empty_context"));
		fieldset.appendChild(make_span(id_string + "_startx_test"));
		fieldset.appendChild(make_span(id_string + "_starty_test"));
		fieldset.appendChild(make_span(id_string + "_startz_test"));
		fieldset.appendChild(document.createElement("br"));

		fieldset.appendChild(document.createTextNode("End coordinate (x, y, z) "));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_endx", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_endy", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_endz", "isFinite", "empty_context"));
		fieldset.appendChild(make_span(id_string + "_endx_test"));
		fieldset.appendChild(make_span(id_string + "_endy_test"));
		fieldset.appendChild(make_span(id_string + "_endz_test"));
		fieldset.appendChild(document.createElement("br"));

	} else if (shape == "sphere") {

		fieldset.appendChild(document.createTextNode("Center coordinate (x, y, z) "));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_centerx", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_centery", "isFinite", "empty_context"));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_centerz", "isFinite", "empty_context"));
		fieldset.appendChild(make_span(id_string + "_centerx_test"));
		fieldset.appendChild(make_span(id_string + "_centery_test"));
		fieldset.appendChild(make_span(id_string + "_centerz_test"));
		fieldset.appendChild(document.createElement("br"));

		fieldset.appendChild(document.createTextNode("Radius "));
		fieldset.appendChild(make_input_element_for_expression(id_string + "_radius", "gt_zero", "empty_context"));
		fieldset.appendChild(make_span(id_string + "_radius_test"));
		fieldset.appendChild(document.createElement("br"));
	}

	document.getElementById("geometries").appendChild(fieldset);
}

box_geometry_adder = document.getElementById("add_box_geometry"),
box_geometry_adder.addEventListener("click", function() {
   make_geometry("box");
});

sphere_geometry_adder = document.getElementById("add_sphere_geometry"),
sphere_geometry_adder.addEventListener("click", function() {
   make_geometry("sphere");
});


function is_valid_geometry_id()
{
	notification = document.getElementById(this.id + "_test");
	if (
		isFinite(this.value)
		&& this.value >= 0
		&& this.value < nr_geometries
	) {
		notification.innerHTML = "";
		notification.style.color = "initial";
	} else {
		notification.innerHTML = "Invalid geometry id";
		notification.style.color = "red";
	}
}


// creates an input set for a boundary
function get_bdy_input_common(id_string, add_values, add_time_stamps)
{
	div = document.createElement("div");
	div.setAttribute("id", "bdy_input_" + id_string);

	// add checked input for geometry id
	div.appendChild(document.createTextNode("Region (geometry id): "));
	geometry_input = make_input_element(id_string + "_geometry_id");
	geometry_input.onblur = is_valid_geometry_id;
	div.appendChild(geometry_input);
	div.appendChild(make_span(id_string + "_geometry_id_test"));

	if (add_time_stamps == true) {
		div.appendChild(document.createElement("br"));
		div.appendChild(document.createTextNode("Time stamps: "));
		time_stamps_input = make_input_element(id_string + "_time_stamps_id");
		div.appendChild(time_stamps_input);
		div.appendChild(make_span(id_string + "_time_stamps_id_test"));
	}

	if (add_values == true) {
		div.appendChild(document.createElement("br"));
		// add (TODO: checked) input for x/radius values
		select = document.createElement("select");
		select.setAttribute("id", id_string + "_coord1_id");
		select.setAttribute("required", "");
		option = document.createElement("option");
		option.setAttribute("value", "x");
		option.innerHTML = "x";
		select.appendChild(option);
		option = document.createElement("option");
		option.setAttribute("value", "radius");
		option.innerHTML = "radius";
		select.appendChild(option);
		div.appendChild(select);
		div.appendChild(make_input_element(id_string + "_coord1_values"));
		div.appendChild(document.createElement("br"));

		// y/lat
		select = document.createElement("select");
		select.setAttribute("id", id_string + "_coord2_id");
		select.setAttribute("required", "");
		option = document.createElement("option");
		option.setAttribute("value", "y");
		option.innerHTML = "y";
		select.appendChild(option);
		option = document.createElement("option");
		option.setAttribute("value", "lat");
		option.innerHTML = "lat";
		select.appendChild(option);
		div.appendChild(select);
		div.appendChild(make_input_element(id_string + "_coord2_values"));
		div.appendChild(document.createElement("br"));

		// z/lon
		select = document.createElement("select");
		select.setAttribute("id", id_string + "_coord3_id");
		select.setAttribute("required", "");
		option = document.createElement("option");
		option.setAttribute("value", "z");
		option.innerHTML = "z";
		select.appendChild(option);
		option = document.createElement("option");
		option.setAttribute("value", "lon");
		option.innerHTML = "lon";
		select.appendChild(option);
		div.appendChild(select);
		div.appendChild(make_input_element(id_string + "_coord3_values"));
		div.appendChild(document.createElement("br"));

		// add checked input for value
		div.appendChild(document.createTextNode(" Values: "));
		div.appendChild(make_input_element_for_expression(id_string + "_value", "gt_zero", "time_place_current_context"));
		div.appendChild(make_span(id_string + "_value_test"));
		div.appendChild(document.createElement("br"));
	}

	return div;
}


// removes last boundary of given type from given variable
function remove_boundary_item(variable, nr_items, bdy_type)
{
	if (nr_items.n <= 0) {
		return;
	}

	nr_items.n = nr_items.n - 1;

	fieldset = document.getElementById(bdy_type + "_" + variable + "_fieldset");
	if (fieldset != null) {
		div = document.getElementById(
			"bdy_input_" + bdy_type + "_"
			+ variable + "_"
			+ nr_items.n.toString()
		);
		fieldset.removeChild(div);
	}

	if (nr_items.n == 0) {
		fieldset.parentNode.removeChild(fieldset);
	}
}

function remove_initial_item(variable, nr_items)
{
	remove_boundary_item(variable, nr_items, "initial");
}

// adds initial condition of given variable
function add_initial_item(variable, nr_items, remover, info)
{
	fieldset = document.getElementById("initial_" + variable + "_fieldset");
	if (fieldset == null) {
		fieldset = document.createElement("fieldset");
		fieldset.setAttribute("id", "initial_" + variable + "_fieldset");
		legend = document.createElement("legend");
		legend.innerHTML = "Initial conditions";
		fieldset.appendChild(legend);

		button = document.createElement("button");
		button.addEventListener("click", remover);
		button.setAttribute("id", "remove_initial_" + variable);
		button.setAttribute("type", "button");
		button.innerHTML = "Remove last item";
		fieldset.appendChild(button);
		fieldset.appendChild(document.createElement("br"));
		info.appendChild(fieldset);
	}

	item_id = nr_items.n.toString();
	nr_items.n = nr_items.n + 1;
	id_string = "initial_" + variable + "_" + item_id;

	fieldset.appendChild(get_bdy_input_common(id_string, true, false));
}

// adds value boundary of given variable
function add_value_item(variable, nr_items, remover, info)
{
	fieldset = document.getElementById("value_" + variable + "_fieldset");
	if (fieldset == null) {
		fieldset = document.createElement("fieldset");
		fieldset.setAttribute("id", "value_" + variable + "_fieldset");
		legend = document.createElement("legend");
		legend.innerHTML = "Value boundaries";
		fieldset.appendChild(legend);

		button = document.createElement("button");
		button.addEventListener("click", remover);
		button.setAttribute("id", "remove_value_" + variable);
		button.setAttribute("type", "button");
		button.innerHTML = "Remove last item";
		fieldset.appendChild(button);
		fieldset.appendChild(document.createElement("br"));
		info.appendChild(fieldset);
	}

	item_id = nr_items.n.toString();
	nr_items.n = nr_items.n + 1;
	id_string = "value_" + variable + "_" + item_id;

	fieldset.appendChild(get_bdy_input_common(id_string, true, true));
}

// adds copy boundary of given variable
function add_copy_item(variable, nr_items, remover, info)
{
	fieldset = document.getElementById("copy_" + variable + "_fieldset");
	if (fieldset == null) {
		fieldset = document.createElement("fieldset");
		fieldset.setAttribute("id", "copy_" + variable + "_fieldset");
		legend = document.createElement("legend");
		legend.innerHTML = "Copy boundaries";
		fieldset.appendChild(legend);

		button = document.createElement("button");
		button.addEventListener("click", remover);
		button.setAttribute("id", "remove_copy_" + variable);
		button.setAttribute("type", "button");
		button.innerHTML = "Remove last item";
		fieldset.appendChild(button);
		fieldset.appendChild(document.createElement("br"));
		info.appendChild(fieldset);
	}

	item_id = nr_items.n.toString();
	nr_items.n = nr_items.n + 1;
	id_string = "copy_" + variable + "_" + item_id;

	fieldset.appendChild(get_bdy_input_common(id_string, false, false));
}


// number density related stuff

// allow passing by reference
var nr_initial_mass_items = {n: 0};

function remove_initial_mass_item() {
	remove_initial_item("mass", nr_initial_mass_items);
}

function add_initial_mass_item() {
	add_initial_item(
		"mass",
		nr_initial_mass_items,
		remove_initial_mass_item,
		document.getElementById("number_density_info")
	);
}
initial_mass_adder = document.getElementById("add_initial_mass");
initial_mass_adder.addEventListener("click", add_initial_mass_item);


var nr_value_mass_items = {n: 0};

function remove_value_mass_item() {
	remove_boundary_item("mass", nr_value_mass_items, "value");
}

function add_value_mass_item() {
	add_value_item(
		"mass",
		nr_value_mass_items,
		remove_value_mass_item,
		document.getElementById("number_density_info")
	);
}
value_mass_adder = document.getElementById("add_value_mass");
value_mass_adder.addEventListener("click", add_value_mass_item);


var nr_copy_mass_items = {n: 0};

function remove_copy_mass_item() {
	remove_boundary_item("mass", nr_copy_mass_items, "copy");
}

function add_copy_mass_item() {
	add_copy_item(
		"mass",
		nr_copy_mass_items,
		remove_copy_mass_item,
		document.getElementById("number_density_info")
	);
}
copy_mass_adder = document.getElementById("add_copy_mass");
copy_mass_adder.addEventListener("click", add_copy_mass_item);


// velocity related stuff
var nr_initial_velocity_items = {n: 0};

function remove_initial_velocity_item() {
	remove_initial_item("velocity", nr_initial_velocity_items);
}

function add_initial_velocity_item() {
	add_initial_item(
		"velocity",
		nr_initial_velocity_items,
		remove_initial_velocity_item,
		document.getElementById("velocity_info")
	);
}
initial_velocity_adder = document.getElementById("add_initial_velocity");
initial_velocity_adder.addEventListener("click", add_initial_velocity_item);


var nr_value_velocity_items = {n: 0};

function remove_value_velocity_item() {
	remove_boundary_item("velocity", nr_value_velocity_items, "value");
}

function add_value_velocity_item() {
	add_value_item(
		"velocity",
		nr_value_velocity_items,
		remove_value_velocity_item,
		document.getElementById("velocity_info")
	);
}
value_velocity_adder = document.getElementById("add_value_velocity");
value_velocity_adder.addEventListener("click", add_value_velocity_item);


var nr_copy_velocity_items = {n: 0};

function remove_copy_velocity_item() {
	remove_boundary_item("velocity", nr_copy_velocity_items, "copy");
}

function add_copy_velocity_item() {
	add_copy_item(
		"velocity",
		nr_copy_velocity_items,
		remove_copy_velocity_item,
		document.getElementById("velocity_info")
	);
}
copy_velocity_adder = document.getElementById("add_copy_velocity");
copy_velocity_adder.addEventListener("click", add_copy_velocity_item);


// pressure related stuff
var nr_initial_pressure_items = {n: 0};

function remove_initial_pressure_item() {
	remove_initial_item("pressure", nr_initial_pressure_items);
}

function add_initial_pressure_item() {
	add_initial_item(
		"pressure",
		nr_initial_pressure_items,
		remove_initial_pressure_item,
		document.getElementById("pressure_info")
	);
}
initial_pressure_adder = document.getElementById("add_initial_pressure");
initial_pressure_adder.addEventListener("click", add_initial_pressure_item);


var nr_value_pressure_items = {n: 0};

function remove_value_pressure_item() {
	remove_boundary_item("pressure", nr_value_pressure_items, "value");
}

function add_value_pressure_item() {
	add_value_item(
		"pressure",
		nr_value_pressure_items,
		remove_value_pressure_item,
		document.getElementById("pressure_info")
	);
}
value_pressure_adder = document.getElementById("add_value_pressure");
value_pressure_adder.addEventListener("click", add_value_pressure_item);


var nr_copy_pressure_items = {n: 0};

function remove_copy_pressure_item() {
	remove_boundary_item("pressure", nr_copy_pressure_items, "copy");
}

function add_copy_pressure_item() {
	add_copy_item(
		"pressure",
		nr_copy_pressure_items,
		remove_copy_pressure_item,
		document.getElementById("pressure_info")
	);
}
copy_pressure_adder = document.getElementById("add_copy_pressure");
copy_pressure_adder.addEventListener("click", add_copy_pressure_item);


// magnetic field related stuff
var nr_initial_magnetic_field_items = {n: 0};

function remove_initial_magnetic_field_item() {
	remove_initial_item("magnetic_field", nr_initial_magnetic_field_items);
}

function add_initial_magnetic_field_item() {
	add_initial_item(
		"magnetic_field",
		nr_initial_magnetic_field_items,
		remove_initial_magnetic_field_item,
		document.getElementById("magnetic_field_info")
	);
}
initial_magnetic_field_adder = document.getElementById("add_initial_magnetic_field");
initial_magnetic_field_adder.addEventListener("click", add_initial_magnetic_field_item);


var nr_value_magnetic_field_items = {n: 0};

function remove_value_magnetic_field_item() {
	remove_boundary_item("magnetic_field", nr_value_magnetic_field_items, "value");
}

function add_value_magnetic_field_item() {
	add_value_item(
		"magnetic_field",
		nr_value_magnetic_field_items,
		remove_value_magnetic_field_item,
		document.getElementById("magnetic_field_info")
	);
}
value_magnetic_field_adder = document.getElementById("add_value_magnetic_field");
value_magnetic_field_adder.addEventListener("click", add_value_magnetic_field_item);


var nr_copy_magnetic_field_items = {n: 0};

function remove_copy_magnetic_field_item() {
	remove_boundary_item("magnetic_field", nr_copy_magnetic_field_items, "copy");
}

function add_copy_magnetic_field_item() {
	add_copy_item(
		"magnetic_field",
		nr_copy_magnetic_field_items,
		remove_copy_magnetic_field_item,
		document.getElementById("magnetic_field_info")
	);
}
copy_magnetic_field_adder = document.getElementById("add_copy_magnetic_field");
copy_magnetic_field_adder.addEventListener("click", add_copy_magnetic_field_item);


// clears current configuration
var configuration_clearer = document.getElementById("clear");
configuration_clearer.addEventListener("click", function() {
	document.getElementById("solver_mhd").selectedIndex = "2";
	document.getElementById("time_start").value = "";
	document.getElementById("time_length").value = "";
	document.getElementById("save_mhd_n").value = "";
	document.getElementById("resistivity").value = "";
	document.getElementById("remove_div_b_n").value = "";
	document.getElementById("adiabatic_index").value = "";
	document.getElementById("vacuum_permeability").value = "";
	document.getElementById("proton_mass").value = "";
	document.getElementById("time_step_factor").value = "";
	document.getElementById("output_directory").value = "";
	document.getElementById("periodic_x").selectedIndex = "0";
	document.getElementById("periodic_y").selectedIndex = "0";
	document.getElementById("periodic_z").selectedIndex = "0";
	document.getElementById("cells_x").value = "";
	document.getElementById("cells_y").value = "";
	document.getElementById("cells_z").value = "";
	document.getElementById("volume_x").value = "";
	document.getElementById("volume_y").value = "";
	document.getElementById("volume_z").value = "";
	document.getElementById("start_x").value = "";
	document.getElementById("start_y").value = "";
	document.getElementById("start_z").value = "";
	document.getElementById("default_mass").value = "";
	document.getElementById("default_pressure").value = "";
	document.getElementById("default_velocity").value = "";
	document.getElementById("default_magnetic_field").value = "";
	while (nr_geometries > 0) {
		remove_geometry();
	}
	while (nr_initial_mass_items.n > 0) {
		remove_initial_mass_item();
	}
	while (nr_value_mass_items.n > 0) {
		remove_value_mass_item();
	}
	while (nr_copy_mass_items.n > 0) {
		remove_copy_mass_item();
	}
	while (nr_initial_velocity_items.n > 0) {
		remove_initial_velocity_item();
	}
	while (nr_value_velocity_items.n > 0) {
		remove_value_velocity_item();
	}
	while (nr_copy_velocity_items.n > 0) {
		remove_copy_velocity_item();
	}
	while (nr_initial_pressure_items.n > 0) {
		remove_initial_pressure_item();
	}
	while (nr_value_pressure_items.n > 0) {
		remove_value_pressure_item();
	}
	while (nr_copy_pressure_items.n > 0) {
		remove_copy_pressure_item();
	}
	while (nr_initial_magnetic_field_items.n > 0) {
		remove_initial_magnetic_field_item();
	}
	while (nr_value_magnetic_field_items.n > 0) {
		remove_value_magnetic_field_item();
	}
	while (nr_copy_magnetic_field_items.n > 0) {
		remove_copy_magnetic_field_item();
	}
});


// sets innerHTML of item with id config_text to current configuration
var config_text_updater = document.getElementById("update_config_text");
config_text_updater.addEventListener("click", function() {
	var new_html
		= "<br>{<br>"
		+ "&quot;output-directory&quot;: &quot;"
		+ document.getElementById("output_directory").value + "&quot;,<br>"
		+ "&quot;solver-mhd&quot;: &quot;"
		+ document.getElementById("solver_mhd").value + "&quot;,<br>"
		+ "&quot;time-start&quot;: "
		+ document.getElementById("time_start").value + ",<br>"
		+ "&quot;time-length&quot;: "
		+ document.getElementById("time_length").value + ",<br>"
		+ "&quot;save-mhd-n&quot;: "
		+ document.getElementById("save_mhd_n").value + ",<br>"
		+ "&quot;resistivity&quot;: &quot;"
		+ document.getElementById("resistivity").value + "&quot;,<br>"
		+ "&quot;remove-div-B-n&quot;: "
		+ document.getElementById("remove_div_b_n").value + ",<br>"
		+ "&quot;adiabatic-index&quot;: "
		+ document.getElementById("adiabatic_index").value + ",<br>"
		+ "&quot;vacuum-permeability&quot;: "
		+ document.getElementById("vacuum_permeability").value + ",<br>"
		+ "&quot;proton-mass&quot;: "
		+ document.getElementById("proton_mass").value + ",<br>"
		+ "&quot;time-step-factor&quot;: "
		+ document.getElementById("time_step_factor").value + ",<br>"
		+ "&quot;load-balancer&quot;: &quot;RCB&quot;,<br>"
		+ "&quot;poisson-norm-stop&quot;: 1e-10,<br>"
		+ "&quot;poisson-norm-increase-max&quot;: 10,<br>"
		+ "&quot;grid-options&quot;: {<br>"
		+ "&nbsp;&nbsp;&quot;periodic&quot;: &quot;{"
		+ document.getElementById("periodic_x").value + ", "
		+ document.getElementById("periodic_y").value + ", "
		+ document.getElementById("periodic_z").value + "}&quot;,<br>"
		+ "&nbsp;&nbsp;&quot;cells&quot;: &quot;{"
		+ document.getElementById("cells_x").value + ", "
		+ document.getElementById("cells_y").value + ", "
		+ document.getElementById("cells_z").value + "}&quot;,<br>"
		+ "&nbsp;&nbsp;&quot;volume&quot;: &quot;{"
		+ document.getElementById("volume_x").value + ", "
		+ document.getElementById("volume_y").value + ", "
		+ document.getElementById("volume_z").value + "}&quot;,<br>"
		+ "&nbsp;&nbsp;&quot;start&quot;: &quot;{"
		+ document.getElementById("start_x").value + ", "
		+ document.getElementById("start_y").value + ", "
		+ document.getElementById("start_z").value + "}&quot;<br>"
		+ "},<br>";

	if (nr_geometries > 0) {
		new_html += "&quot;geometries&quot;: [<br>"
		for (i = 0; i < nr_geometries; i++) {
			box_id = "box" + i.toString()
			box = document.getElementById(box_id);
			if (box != null) {
				new_html
					+= "&nbsp;&nbsp;{&quot;box&quot;: {<br>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;start&quot;: ["
					+ document.getElementById(box_id + "_startx").value + ", "
					+ document.getElementById(box_id + "_starty").value + ", "
					+ document.getElementById(box_id + "_startz").value + "],<br>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;end&quot;: ["
					+ document.getElementById(box_id + "_endx").value + ", "
					+ document.getElementById(box_id + "_endy").value + ", "
					+ document.getElementById(box_id + "_endz").value + "]<br>&nbsp;&nbsp;}}"

				if (i < nr_geometries - 1) {
					new_html += ",";
				}
				new_html += "<br>";
				continue;
			}

			sphere_id = "sphere" + i.toString()
			sphere = document.getElementById(sphere_id);
			if (sphere != null) {
				new_html
					+= "&nbsp;&nbsp;{&quot;sphere&quot;: {<br>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;center&quot;: ["
					+ document.getElementById(sphere_id + "_centerx").value + ", "
					+ document.getElementById(sphere_id + "_centery").value + ", "
					+ document.getElementById(sphere_id + "_centerz").value + "],<br>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;radius&quot;: ["
					+ document.getElementById(sphere_id + "_radius").value + "]<br>&nbsp;&nbsp;}}"

				if (i < nr_geometries - 1) {
					new_html += ",";
				}
				new_html += "<br>";
				continue;
			}
		}
		new_html += "],<br>";
	}

	// "number-density": { and "default": "",
	new_html
		+= "&quot;number-density&quot;: {<br>"
		+ "&nbsp;&nbsp;&quot;default&quot;: &quot;"
		+ document.getElementById("default_mass").value + "&quot;";

	if (
		nr_initial_mass_items.n > 0
		|| nr_value_mass_items.n > 0
		|| nr_copy_mass_items.n > 0
	) {
		new_html += ",<br>";
	}
	// "initial-conditions": [
	if (nr_initial_mass_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;initial-conditions&quot;: [<br>";
		for (i = 0; i < nr_initial_mass_items.n; i++) {
			id_string = "initial_mass_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;"
				+ document.getElementById(id_string + "_value").value + "&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_initial_mass_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (nr_initial_mass_items.n > 0 && nr_value_mass_items.n > 0) {
		if (nr_value_mass_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	// "value-boundaries": [
	if (nr_value_mass_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;value-boundaries&quot;: [<br>";
		for (i = 0; i < nr_value_mass_items.n; i++) {
			id_string = "value_mass_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;time-stamps&quot;: ["
				+ document.getElementById(id_string + "_time_stamps_id").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;"
				+ document.getElementById(id_string + "_value").value + "&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}}";
			if (i < nr_value_mass_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (
		(nr_initial_mass_items.n > 0 || nr_value_mass_items.n > 0)
		&& nr_copy_mass_items.n > 0
	) {
		if (nr_copy_mass_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	// "copy-boundaries": [
	if (nr_copy_mass_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;copy-boundaries&quot;: [<br>";
		for (i = 0; i < nr_copy_mass_items.n; i++) {
			id_string = "copy_mass_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_copy_mass_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	new_html += "<br>},<br>";


	// velocity
	new_html
		+= "&quot;velocity&quot;: {<br>"
		+ "&nbsp;&nbsp;&quot;default&quot;: &quot;{"
		+ document.getElementById("default_velocity").value + "}&quot;";

	if (
		nr_initial_velocity_items.n > 0
		|| nr_value_velocity_items.n > 0
		|| nr_copy_velocity_items.n > 0
	) {
		new_html += ",<br>";
	}
	if (nr_initial_velocity_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;initial-conditions&quot;: [<br>";
		for (i = 0; i < nr_initial_velocity_items.n; i++) {
			id_string = "initial_velocity_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;{"
				+ document.getElementById(id_string + "_value").value + "}&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_initial_velocity_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (nr_initial_velocity_items.n > 0 && nr_value_velocity_items.n > 0) {
		if (nr_value_velocity_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_value_velocity_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;value-boundaries&quot;: [<br>";
		for (i = 0; i < nr_value_velocity_items.n; i++) {
			id_string = "value_velocity_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;time-stamps&quot;: ["
				+ document.getElementById(id_string + "_time_stamps_id").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;{"
				+ document.getElementById(id_string + "_value").value + "}&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}}";
			if (i < nr_value_velocity_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (
		(nr_initial_velocity_items.n > 0 || nr_value_velocity_items.n > 0)
		&& nr_copy_velocity_items.n > 0
	) {
		if (nr_copy_velocity_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_copy_velocity_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;copy-boundaries&quot;: [<br>";
		for (i = 0; i < nr_copy_velocity_items.n; i++) {
			id_string = "copy_velocity_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_copy_velocity_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	new_html += "<br>},<br>";


	// pressure
	new_html
		+= "&quot;pressure&quot;: {<br>"
		+ "&nbsp;&nbsp;&quot;default&quot;: &quot;"
		+ document.getElementById("default_pressure").value + "&quot;";

	if (
		nr_initial_pressure_items.n > 0
		|| nr_value_pressure_items.n > 0
		|| nr_copy_pressure_items.n > 0
	) {
		new_html += ",<br>";
	}
	if (nr_initial_pressure_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;initial-conditions&quot;: [<br>";
		for (i = 0; i < nr_initial_pressure_items.n; i++) {
			id_string = "initial_pressure_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;"
				+ document.getElementById(id_string + "_value").value + "&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_initial_pressure_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (nr_initial_pressure_items.n > 0 && nr_value_pressure_items.n > 0) {
		if (nr_value_pressure_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_value_pressure_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;value-boundaries&quot;: [<br>";
		for (i = 0; i < nr_value_pressure_items.n; i++) {
			id_string = "value_pressure_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;time-stamps&quot;: ["
				+ document.getElementById(id_string + "_time_stamps_id").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;"
				+ document.getElementById(id_string + "_value").value + "&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}}";
			if (i < nr_value_pressure_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (
		(nr_initial_pressure_items.n > 0 || nr_value_pressure_items.n > 0)
		&& nr_copy_pressure_items.n > 0
	) {
		if (nr_copy_pressure_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_copy_pressure_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;copy-boundaries&quot;: [<br>";
		for (i = 0; i < nr_copy_pressure_items.n; i++) {
			id_string = "copy_pressure_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_copy_pressure_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	new_html += "<br>},<br>";


	// magnetic field
	new_html
		+= "&quot;magnetic-field&quot;: {<br>"
		+ "&nbsp;&nbsp;&quot;default&quot;: &quot;"
		+ document.getElementById("default_magnetic_field").value + "&quot;";

	if (
		nr_initial_magnetic_field_items.n > 0
		|| nr_value_magnetic_field_items.n > 0
		|| nr_copy_magnetic_field_items.n > 0
	) {
		new_html += ",<br>";
	}
	if (nr_initial_magnetic_field_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;initial-conditions&quot;: [<br>";
		for (i = 0; i < nr_initial_magnetic_field_items.n; i++) {
			id_string = "initial_magnetic_field_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;{"
				+ document.getElementById(id_string + "_value").value + "}&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_initial_magnetic_field_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (nr_initial_magnetic_field_items.n > 0 && nr_value_magnetic_field_items.n > 0) {
		if (nr_value_magnetic_field_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_value_magnetic_field_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;value-boundaries&quot;: [<br>";
		for (i = 0; i < nr_value_magnetic_field_items.n; i++) {
			id_string = "value_magnetic_field_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + ",<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;time-stamps&quot;: ["
				+ document.getElementById(id_string + "_time_stamps_id").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&quot;values&quot;: {<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord1_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord1_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord2_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord2_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;"
				+ document.getElementById(id_string + "_coord3_id").value + "&quot;: ["
				+ document.getElementById(id_string + "_coord3_values").value + "],<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [&quot;{"
				+ document.getElementById(id_string + "_value").value + "}&quot;]<br>"
				+ "&nbsp;&nbsp;&nbsp;&nbsp;}}";
			if (i < nr_value_magnetic_field_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	if (
		(nr_initial_magnetic_field_items.n > 0 || nr_value_magnetic_field_items.n > 0)
		&& nr_copy_magnetic_field_items.n > 0
	) {
		if (nr_copy_magnetic_field_items.n > 0) {
			new_html += ",";
		}
		new_html += "<br>";
	}

	if (nr_copy_magnetic_field_items.n > 0) {
		new_html += "&nbsp;&nbsp;&quot;copy-boundaries&quot;: [<br>";
		for (i = 0; i < nr_copy_magnetic_field_items.n; i++) {
			id_string = "copy_magnetic_field_" + i.toString();
			new_html
				+= "&nbsp;&nbsp;&nbsp;&nbsp;{&quot;geometry-id&quot;: "
				+ document.getElementById(id_string + "_geometry_id").value + "&nbsp;&nbsp;&nbsp;&nbsp;}";
			if (i < nr_copy_magnetic_field_items.n - 1) {
				new_html += ",<br>";
			} else {
				new_html += "<br>";
			}
		}
		new_html += "&nbsp;&nbsp;]";
	}

	new_html += "<br>}<br>}";


	var config_text = document.getElementById("config_text");
	while (config_text.hasChildNodes()) {
	    config_text.removeChild(config_text.firstChild);
	}
	config_text.innerHTML = new_html;
});


// shock tube maker
var shock_tube_maker = document.getElementById("make_shock_tube");
shock_tube_maker.addEventListener("click", function() {
	configuration_clearer.click();
	document.getElementById("solver_mhd").selectedIndex = "2";
	document.getElementById("time_start").value = "0";
	document.getElementById("time_length").value = "1";
	document.getElementById("save_mhd_n").value = "0.1";
	document.getElementById("resistivity").value = "0";
	document.getElementById("remove_div_b_n").value = "-1";
	document.getElementById("adiabatic_index").value = "1.6666667";
	document.getElementById("vacuum_permeability").value = "1";
	document.getElementById("proton_mass").value = "1";
	document.getElementById("time_step_factor").value = "0.5";
	document.getElementById("output_directory").value = "shock_tube/";
	document.getElementById("periodic_x").selectedIndex = "0";
	document.getElementById("periodic_y").selectedIndex = "0";
	document.getElementById("periodic_z").selectedIndex = "0";
	document.getElementById("cells_x").value = "100 + 2";
	document.getElementById("cells_y").value = "1";
	document.getElementById("cells_z").value = "1";
	document.getElementById("volume_x").value = "1 + 2 / (cells[0] - 2)";
	document.getElementById("volume_y").value = "1";
	document.getElementById("volume_z").value = "1";
	document.getElementById("start_x").value = "-volume[0] / (cells[0] - 2)";
	document.getElementById("start_y").value = "-volume[1]/2";
	document.getElementById("start_z").value = "-volume[2]/2";
	document.getElementById("default_mass").value = "(x < 0) ? 1 : 0.125";
	document.getElementById("default_pressure").value = "(x < 0) ? 1 : 0.1";
	document.getElementById("default_velocity").value = "0, 0, 0";
	document.getElementById("default_magnetic_field").value = "{0.75, (x < 0) ? 1 : -1, 0}";
	box_geometry_adder.click();
	document.getElementById("box0_startx").value = "-99";
	document.getElementById("box0_starty").value = "-99";
	document.getElementById("box0_startz").value = "-99";
	document.getElementById("box0_endx").value = "-0.5";
	document.getElementById("box0_endy").value = "99";
	document.getElementById("box0_endz").value = "99";
	value_mass_adder.click();
	document.getElementById("value_mass_0_geometry_id").value = 0;
	document.getElementById("value_mass_0_time_stamps_id").value = 0;
	document.getElementById("value_mass_0_coord1_values").value = 0;
	document.getElementById("value_mass_0_coord2_values").value = 0;
	document.getElementById("value_mass_0_coord3_values").value = 0;
	document.getElementById("value_mass_0_value").value = 1;
	value_velocity_adder.click();
	document.getElementById("value_velocity_0_geometry_id").value = 0;
	document.getElementById("value_velocity_0_time_stamps_id").value = 0;
	document.getElementById("value_velocity_0_coord1_values").value = 0;
	document.getElementById("value_velocity_0_coord2_values").value = 0;
	document.getElementById("value_velocity_0_coord3_values").value = 0;
	document.getElementById("value_velocity_0_value").value = "0, 0, 0";
	value_pressure_adder.click();
	document.getElementById("value_pressure_0_geometry_id").value = 0;
	document.getElementById("value_pressure_0_time_stamps_id").value = 0;
	document.getElementById("value_pressure_0_coord1_values").value = 0;
	document.getElementById("value_pressure_0_coord2_values").value = 0;
	document.getElementById("value_pressure_0_coord3_values").value = 0;
	document.getElementById("value_pressure_0_value").value = 1;
	value_magnetic_field_adder.click();
	document.getElementById("value_magnetic_field_0_geometry_id").value = 0;
	document.getElementById("value_magnetic_field_0_time_stamps_id").value = 0;
	document.getElementById("value_magnetic_field_0_coord1_values").value = 0;
	document.getElementById("value_magnetic_field_0_coord2_values").value = 0;
	document.getElementById("value_magnetic_field_0_coord3_values").value = 0;
	document.getElementById("value_magnetic_field_0_value").value = "0.75, 1, 0";
	box_geometry_adder.click();
	document.getElementById("box1_startx").value = "0.5";
	document.getElementById("box1_starty").value = "-99";
	document.getElementById("box1_startz").value = "-99";
	document.getElementById("box1_endx").value = "99";
	document.getElementById("box1_endy").value = "99";
	document.getElementById("box1_endz").value = "99";
	value_mass_adder.click();
	document.getElementById("value_mass_1_geometry_id").value = 0;
	document.getElementById("value_mass_1_time_stamps_id").value = 0;
	document.getElementById("value_mass_1_coord1_values").value = 0;
	document.getElementById("value_mass_1_coord2_values").value = 0;
	document.getElementById("value_mass_1_coord3_values").value = 0;
	document.getElementById("value_mass_1_value").value = 0.125;
	value_velocity_adder.click();
	document.getElementById("value_velocity_1_geometry_id").value = 0;
	document.getElementById("value_velocity_1_time_stamps_id").value = 0;
	document.getElementById("value_velocity_1_coord1_values").value = 0;
	document.getElementById("value_velocity_1_coord2_values").value = 0;
	document.getElementById("value_velocity_1_coord3_values").value = 0;
	document.getElementById("value_velocity_1_value").value = "0, 0, 0";
	value_pressure_adder.click();
	document.getElementById("value_pressure_1_geometry_id").value = 0;
	document.getElementById("value_pressure_1_time_stamps_id").value = 0;
	document.getElementById("value_pressure_1_coord1_values").value = 0;
	document.getElementById("value_pressure_1_coord2_values").value = 0;
	document.getElementById("value_pressure_1_coord3_values").value = 0;
	document.getElementById("value_pressure_1_value").value = 0.1;
	value_magnetic_field_adder.click();
	document.getElementById("value_magnetic_field_1_geometry_id").value = 0;
	document.getElementById("value_magnetic_field_1_time_stamps_id").value = 0;
	document.getElementById("value_magnetic_field_1_coord1_values").value = 0;
	document.getElementById("value_magnetic_field_1_coord2_values").value = 0;
	document.getElementById("value_magnetic_field_1_coord3_values").value = 0;
	document.getElementById("value_magnetic_field_1_value").value = "0.75, -1, 0";
});


}

</script>

<!-- javascript block end -->

</head>

<body>

<!-- configuration creator start -->

<h1>Configuration file creator for MHD test program of PAMHD</h1>

<h2>Presets</h2>
<p>
Use these buttons to automatically fill the forms below to create configuration files for some example simulations.
The corresponding configuration file will appear at the bottom of the page.
If you have installed the model locally you can copy &amp; paste the configuration into a file and give it to pamhd/tests/mhd/test.exe as a command line argument.<br>
<button id="make_shock_tube" type="button">Shock tube</button>
<button id="make_kelvin_helmholtz" type="button">Kelvin-Helmholtz</button>
<button id="make_reconnection" type="button">Reconnection</button>
<button id="make_orszag_tang" type="button">Orszag-Tang</button>
<button id="make_bow_shock" type="button">Bow shock</button>
<button id="make_blast_wave" type="button">Blast wave</button>
</p>

<h2>Configuration interface</h2>
<p>
Fill out the below forms with simulation parameters.
Use the add and remove buttons to modify the number of additional regions of different types of boundaries for each simulation variable:
<ul>
<li>initial condition: before simulation is started these regions are filled with given data</li>
<li>value boundary: when simulation is running these regions are filled with given data after every simulation step</li>
<li>copy boundary: when simulation is running these regions set their value based on data in nearest non-boundary cells after every simulation step</li>
</ul>
Every type of boundary must refer to a region within the simulation by its geometry id.
Simulation regions have to be added separately using buttons in the geometries part of the form.
Expressions for values of MHD variables can refer to the x, y and z coordinates of cells' center with x, y, z respectively and current simulation time with t.
</p>

<!-- form start -->

<form method="get" id="form" onsubmit="convert_parentheses()">
	<input type="submit" value="Submit run"><br>
	<fieldset id="simulation">
		<legend>General simulation parameteres</legend>

		Solver to use
		<select id="solver_mhd" name="solver_mhd" required>
			<option value="hll-athena">hll-athena</option>
			<option value="hlld-athena">hlld-athena</option>
			<option value="roe-athena" selected>roe-athena</option>
		</select><br>

		Start time of simulation
		<input
			type="text"
			id="time_start"
			name="time_start"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"
		>
			<span id="time_start_test"></span>
		<br>

		Duration of simulation (> 0)
		<input
			type="text"
			id="time_length"
			name="time_length"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="time_length_test"></span>
		<br>

		Time interval for saving simulation results (< 0 skips saving)
		<input
			type="text"
			id="save_mhd_n"
			name="save_mhd_n"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"
		>
			<span id="save_mhd_n_test"></span>
		<br>

		Expression for electric resistivity (can also refer to magnitude of electric current density as J)
		<input
			type="text"
			id="resistivity"
			name="resistivity"
			onKeyUp="validate_expression(this.id, isFinite, time_place_current_context)"><span id="resistivity_test"></span>
		<br>

		Time interval for removing divergence of magnetic field (< 0 skips removal)
		<input
			type="text"
			id="remove_div_b_n"
			name="remove_div_b_n"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"><span id="remove_div_b_n_test"></span>
		<br>

		Value of adiabatic index (> 1)
		<input
			type="text"
			id="adiabatic_index"
			name="adiabatic_index"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"><span id="adiabatic_index_test"></span>
		<br>

		Value of vacuum permeability (> 0)
		<input
			type="text"
			id="vacuum_permeability"
			name="vacuum_permeability"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"><span id="vacuum_permeability_test"></span>
		<br>

		Value of proton mass (> 0)
		<input
			type="text"
			id="proton_mass"
			name="proton_mass"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"><span id="proton_mass_test"></span>
		<br>

		Fraction of maximum allowed time step to use (> 0, < 1)
		<input
			type="text"
			id="time_step_factor"
			name="time_step_factor"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"><span id="time_step_factor_test"></span>
		<br>

		<!-- outdir start -->
		Output directory for results relative to current directory
		<input
			type="text"
			id="output_directory"
			name="output_directory">
		<br>
		<!-- outdir end -->
	</fieldset>

	<fieldset id="grid">
		<legend>Parameters of simulation grid</legend>
		Periodicity in x, y and z dimensions

		<select id="periodic_x" name="periodic_x" required>
			<option value="false">false</option>
			<option value="true">true</option>
		</select>
		<select id="periodic_y" name="periodic_y" required>
			<option value="false">false</option>
			<option value="true">true</option>
		</select>
		<select id="periodic_z" name="periodic_z" required>
			<option value="false">false</option>
			<option value="true">true</option>
		</select>
		<br>

		Number of cells in x, y and z dimensions (> 0)
		<input
			type="text"
			id="cells_x"
			name="cells_x"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="cells_x_test"></span>
		<input
			type="text"
			id="cells_y"
			name="cells_y"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="cells_y_test"></span>
		<input
			type="text"
			id="cells_z"
			name="cells_z"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="cells_z_test"></span>
		<br>

		Volume in x, y and z dimensions (> 0)
		<input
			type="text"
			id="volume_x"
			name="volume_x"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="volume_x_test"></span>
		<input
			type="text"
			id="volume_y"
			name="volume_y"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="volume_y_test"></span>
		<input
			type="text"
			id="volume_z"
			name="volume_z"
			onKeyUp="validate_expression(this.id, gt_zero, empty_context)"
		>
			<span id="volume_z_test"></span>
		<br>

		Starting coordinate in x, y and z dimensions
		<input
			type="text"
			id="start_x"
			name="start_x"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"
		>
			<span id="start_x_test"></span>
		<input
			type="text"
			id="start_y"
			name="start_y"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"
		>
			<span id="start_y_test"></span>
		<input
			type="text"
			id="start_z"
			name="start_z"
			onKeyUp="validate_expression(this.id, isFinite, empty_context)"
		>
			<span id="start_z_test"></span>
		<br>
	</fieldset>


	<fieldset id="geometries">
		<legend>Geometries for initial and boundary conditions</legend>

		<button id="add_box_geometry" type="button">
			Add box
		</button>

		<button id="add_sphere_geometry" type="button">
			Add sphere
		</button>

		<button id="remove_geometry_btn" type="button">
			Remove last
		</button>
	</fieldset>


	<fieldset id="number_density_info">
		<legend>Number density</legend>

		Default (> 0, mandatory)
		<input
			type="text"
			id="default_mass"
			name="default_mass"
			onKeyUp="validate_expression(this.id, gt_zero, time_place_context)"
		>
			<span id="default_mass_test"></span>
		<br>

		<button id="add_initial_mass" type="button">
			Add initial condition
		</button>

		<button id="add_value_mass" type="button">
			Add value boundary
		</button>

		<button id="add_copy_mass" type="button">
			Add copy boundary
		</button>
	</fieldset>

	<fieldset id="velocity_info">
		<legend>Velocity</legend>

		Default (mandatory)
		<input
			type="text"
			id="default_velocity"
			name="default_velocity"
			onKeyUp="validate_expression(this.id, isFinite, time_place_context)"
		>
			<span id="default_velocity_test"></span>
		<br>

		<button id="add_initial_velocity" type="button">
			Add initial condition
		</button>

		<button id="add_value_velocity" type="button">
			Add value boundary
		</button>

		<button id="add_copy_velocity" type="button">
			Add copy boundary
		</button>
	</fieldset>

	<fieldset id="pressure_info">
		<legend>Thermal pressure</legend>

		Default (> 0, mandatory)
		<input
			type="text"
			id="default_pressure"
			name="default_pressure"
			onKeyUp="validate_expression(this.id, gt_zero, time_place_context)"
		>
			<span id="default_pressure_test"></span>
		<br>

		<button id="add_initial_pressure" type="button">
			Add initial condition
		</button>

		<button id="add_value_pressure" type="button">
			Add value boundary
		</button>

		<button id="add_copy_pressure" type="button">
			Add copy boundary
		</button>
	</fieldset>

	<fieldset id="magnetic_field_info">
		<legend>Magnetic field</legend>

		Default (mandatory)
		<input
			type="text"
			id="default_magnetic_field"
			name="default_magnetic_field"
			onKeyUp="validate_expression(this.id, isFinite, time_place_context)"
		>
			<span id="default_magnetic_field_test"></span>
		<br>

		<button id="add_initial_magnetic_field" type="button">
			Add initial condition
		</button>

		<button id="add_value_magnetic_field" type="button">
			Add value boundary
		</button>

		<button id="add_copy_magnetic_field" type="button">
			Add copy boundary
		</button>
	</fieldset>

</form>
<button id="clear" type="button">Clear</button><br><br>

<button id="update_config_text" type="button">View configuration</button> 
<samp id="config_text"><br>Push the button above to see current configuration</samp>

<!-- form end -->

</body>
</html>
